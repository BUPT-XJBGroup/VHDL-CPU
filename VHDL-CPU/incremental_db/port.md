2019年3月28日

今天阅读了TEC-8实验指导书。首先看了EPM7128的引脚规定，知道了哪些针脚用于输出，哪些用来输入以及相关的功能。然后是规划了大概的指令格式，基础指令是按照书上的格式，新加入了栈的相关指令，具体实现等写到的时候再说，大概是一个支持POP和PUSH的栈。

大致了解了硬连线控制器的实现方法以及流水机的原理。流水机和普通机器的差别在于，流水机在运行程序的同时会进行取指，而普通的机器要花上额外的一个周期用来取指和增加指令计数器，其他部分实现相同。

此外还配置好了开发环境，由于我们使用的EPM7128芯片年代太过古老，在最新的Quartus 18.0上没有对应的芯片型号，只有回到Quartus 9.0才能找到对应的芯片组。

---

2019年4月1日

按照着书上的流程图把代码打完了。过几天去机房调试。

写代码的时候遇到了一些问题。

首先如果不是流水机的话，栈的功能不能完全实现，因为少了一个周期。PUSH本身需要3个时钟周期，如果取指要一个的话，只能去掉栈指针自减少的功能，手动让栈指针减少一个了。此外写的过程中发现POP功能其实是多余的，因为读只要用读存储器的方法就行了，减一的话用减法功能就行了。

其次有些变量是只写的，要额外弄一些信号来读这些变量。

而且书上的图有个地方有问题，做加法的时候没有LDC，不过有问题的只有一张图，从其他图上看来还是需要LDC的。

---

2019年4月8日

SEL3210和IR3210虽然是同一个信号表示，但是SEL3210 不能被读出。同时IR7654只能读入，不能写入。这个与预期的设想不太一样，这意味着，有些时候不能由控制器给出一些参数，而是要用户手动输入特定的参数。

完成了栈的相关指令：读出栈指针的指令LSP，重写栈指针的指令SSP，压栈指令PUSH。此外还有一个比较简单的MOV指令，用ALU的功能实现。

调试遇到的问题：

- 代码一直无法导入到试验箱中，后来换了几个试验箱后才解决了问题。
- 忘记把DP设置成单拍模式，导致调试的时候PC和IR一直有问题。

---

2019年4月15日

继续调试代码，测试了所有写的功能。遇到了不少问题:

- 在执行指令的时候，S的显示有问题，S1一直处于不亮的状态，后来通过把S1输出到暂时用不到的SEL灯上发现S1实际上是正常的，只是试验箱的S1对应的LED灯有问题。
- 测试JC和JZ的时候测试程序写错了。同时，JC和JZ的偏移量是用补码表示的，最高位的1表示是负数，所以不能尝试太大的跳跃。
- 主存储器的地址位00111111的时候，使AR加一后，地址直接跳变为00000000，后来发现是LED灯显示有问题。
- USB线似乎有问题，连接电脑后一直显示未知硬件，换线后就好了。
- 想要把STOP置为1的时候不能直接修改，直接修改可能导致冲突的问题。后来新建了一个STOP的信号，每次修改只修改信号，然后把信号关联到一个函数上，每次到一个周期的结束的时候如果信号改变就会吧STOP置为1。
- DBUS的LED灯坏了。

---

2019年5月13日

测试了老师新给的测试程序，没有什么问题。
